{{ define "create_quick_quote_form.html" }}
<form id="createQuickQuoteForm" class="space-y-4">
    <div>
        <input type="hidden" name="csrf_token" value="{{ .CSRFToken }}" />
        <input type="hidden" name="lead_id" value="{{ .Lead.LeadID }}" />
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
            <div class="grow space-y-1">
                <label for="event_date" class="font-medium">Cual sería la hora y fecha del evento?</label>
                <input type="datetime-local" id="event_date" name="event_date"
                    class="block w-full rounded-lg border border-gray-200 px-5 py-3 leading-6 placeholder-gray-500 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-primary" />
            </div>
            <div class="grow space-y-1">
                <label for="event_date" class="font-medium">Cúantas horas será el evento?</label>
                <input type="datetime-local" id="event_date" name="event_date"
                    class="block w-full rounded-lg border border-gray-200 px-5 py-3 leading-6 placeholder-gray-500 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-primary" />
            </div>
        </div>
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
            <div class="grow space-y-1">
                <label for="guests" class="font-medium">Cúantos adultos estarán en el evento?</label>
                <input type="number" id="guests" name="guests"
                    class="block w-full rounded-lg border border-gray-200 px-5 py-3 leading-6 placeholder-gray-500 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-primary" />
            </div>
            <div class="grow space-y-1">
                <label for="number_of_bartenders" class="font-medium">Número de bartenders</label>
                <input type="number" id="number_of_bartenders" name="number_of_bartenders" required
                    class="block w-full rounded-lg border border-gray-200 px-5 py-3 leading-6 placeholder-gray-500 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-primary" />
            </div>
        </div>
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
            <label for="bar_rental"
                class="group relative inline-flex items-center gap-3">
                <input type="checkbox" class="peer sr-only" id="bar_rental" name="bar_rental" />
                <span
                    class="hover:cursor-pointer relative h-7 w-12 flex-none rounded-full bg-gray-300 transition-all duration-150 ease-out before:absolute before:left-1 before:top-1 before:size-5 before:rounded-full before:bg-white before:transition-transform before:duration-150 before:ease-out before:content-[''] peer-checked:bg-primary-500 peer-checked:before:translate-x-full peer-focus:ring peer-focus:ring-primary-500/50 peer-focus:ring-offset-2 peer-focus:ring-offset-white peer-disabled:cursor-not-allowed peer-disabled:opacity-75 dark:bg-gray-700 dark:peer-checked:bg-primary-500 dark:peer-focus:ring-offset-gray-900"></span>
                <span class="font-medium">Necesita que llevemos barra(s)?</span>
            </label>
            <div class="grow space-y-1">
                <label for="num_bars" class="font-medium">Cuantas barras?</label>
                <input type="number" id="num_bars" name="num_bars"
                    class="block w-full rounded-lg border border-gray-200 px-5 py-3 leading-6 placeholder-gray-500 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-primary" />
            </div>
        </div>
        <div id="typeOfBar" class="grow space-y-1">
            <label for="type_of_bar" class="font-medium">Selecciona el tipo de barra</label>
            <select id="type_of_bar" name="type_of_bar"
                class="block w-full rounded-lg border border-gray-200 px-5 py-3 leading-6 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:focus:border-primary">
                <option></option>
                {{ range .BarRentalQuoteServices }}
                <option value="{{ .ServiceID }}" data-suggested-price="{{ .SuggestedPrice }}">
                    {{ .Service }} - ${{ .SuggestedPrice }}
                </option>
                {{ end }}
            </select>
        </div>
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
            <div class="grow space-y-1">
                <label for="bring_alcohol" class="group relative inline-flex items-center gap-3">
                    <input type="checkbox" class="peer sr-only" id="bring_alcohol" name="bring_alcohol" />
                    <span
                        class="hover:cursor-pointer relative h-7 w-12 flex-none rounded-full bg-gray-300 transition-all duration-150 ease-out before:absolute before:left-1 before:top-1 before:size-5 before:rounded-full before:bg-white before:transition-transform before:duration-150 before:ease-out before:content-[''] peer-checked:bg-primary-500 peer-checked:before:translate-x-full peer-focus:ring peer-focus:ring-primary-500/50 peer-focus:ring-offset-2 peer-focus:ring-offset-white peer-disabled:cursor-not-allowed peer-disabled:opacity-75 dark:bg-gray-700 dark:peer-checked:bg-primary-500 dark:peer-focus:ring-offset-gray-900"></span>
                    <span class="font-medium">Tenemos que llevar alcohol?</span>
                </label>
            </div>
            <div id="alcoholQuality" class="grow space-y-1">
                <label for="alcohol_quality" class="font-medium">Selecciona la calidad del alcohol</label>
                <select id="alcohol_quality" name="alcohol_quality"
                    class="block w-full rounded-lg border border-gray-200 px-5 py-3 leading-6 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:focus:border-primary">
                    <option></option>
                    {{ range .AlcoholQuoteServices }}
                    <option value="{{ .ServiceID }}" data-suggested-price="{{ .SuggestedPrice }}">
                        {{ .Service }} - ${{ .SuggestedPrice }}
                    </option>
                    {{ end }}
                </select>
            </div>
        </div>
        {{ range .QuickQuoteServices }}
        <div class="grow space-y-1">
            <label for="{{ .ServiceHTMLField }}" class="group relative inline-flex items-center gap-3">
                <input type="checkbox" class="peer sr-only" id="{{ .ServiceHTMLField }}" name="{{ .ServiceHTMLField }}" />
                <span
                    class="hover:cursor-pointer relative h-7 w-12 flex-none rounded-full bg-gray-300 transition-all duration-150 ease-out before:absolute before:left-1 before:top-1 before:size-5 before:rounded-full before:bg-white before:transition-transform before:duration-150 before:ease-out before:content-[''] peer-checked:bg-primary-500 peer-checked:before:translate-x-full peer-focus:ring peer-focus:ring-primary-500/50 peer-focus:ring-offset-2 peer-focus:ring-offset-white peer-disabled:cursor-not-allowed peer-disabled:opacity-75 dark:bg-gray-700 dark:peer-checked:bg-primary-500 dark:peer-focus:ring-offset-gray-900"></span>
                <span class="font-medium">Tenemos que llevar {{ .Service }} - ${{ .SuggestedPrice }} / persona?</span>
            </label>
        </div>
        {{ end }}
    </div>
    <button type="submit"
        class="inline-flex items-center justify-center gap-2 rounded-lg border border-primary-700 bg-primary-700 px-3 py-2 text-sm font-semibold leading-5 text-white hover:border-primary-600 hover:bg-primary-600 hover:text-white focus:ring focus:ring-primary-400/50 active:border-primary-700 active:bg-primary-700 dark:focus:ring-primary-400/90">
        <svg class="bi bi-send-fill inline-block size-5" xmlns="http://www.w3.org/2000/svg"
            fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
            <path
                d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z" />
        </svg>
        <span>Crear Cotización</span>
    </button>
</form>

<script nonce="{{ .Nonce }}">
    const createQuickQuoteForm = document.getElementById("createQuickQuoteForm");

    function handleCreateQuickQuote(e) {
		e.preventDefault();
		const alertModal = document.getElementById("alertModal");

        alert("Implement form submission logic!");

        return;

		const data = new FormData(e.target);
		const body = new FormData();

		for (const [key, value] of data.entries()) {
			if (value) body.append(key, value);
		}

		fetch("/crm/lead/{{ .Lead.LeadID }}/quick-quote", {
			method: "POST",
			credentials: "include",
			body: body,
		})
		.then((response) => {
			const token = response.headers.get('X-Csrf-Token');
			if (token) {
				const tokens = document.querySelectorAll('[name="csrf_token"]');
				tokens.forEach(csrf_token => csrf_token.value = token);
			}
			if (response.ok) {
				return response.text();
			} else {
				return response.text().then((err) => {
					throw new Error(err);
				});
			}
		})
		.then(html => {
			alertModal.outerHTML = html;
			createQuickQuoteForm.reset();
		})
		.catch(err => {
			alertModal.outerHTML = err.message;
		})
        .finaly(() => handleCloseAlertModal());
    }

    createQuickQuoteForm.addEventListener("submit", (e) => handleCreateQuickQuote(e));

    const bartenders = document.getElementById("number_of_bartenders");
    const numBars = document.getElementById("num_bars");
    const guests = document.getElementById("guests");
    const barRental = document.getElementById("bar_rental");
    const typeOfBar = document.getElementById("typeOfBar");
    const bringAlcohol = document.getElementById("bring_alcohol");
    const alcoholQuality = document.getElementById("alcoholQuality");

    function handleCalculateBartenders(guests) {
        bartenders.value = Math.ceil(guests / 50);
    }

    function handleBarRental(event) {
        if (event.target.checked) {
            numBars.value = bartenders.value;

            typeOfBar.style.display = "";
        }
    }

    function handleBringAlcohol(event) {
        if (event.target.checked) alcoholQuality.style.display = "";
    }

    guests.addEventListener("change", (e) => handleCalculateBartenders(e.target.value));

    barRental.addEventListener("change", (e) => handleBarRental(e));

    bringAlcohol.addEventListener("change", (e) => handleBringAlcohol(e));
</script>
{{ end }}